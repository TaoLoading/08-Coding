# Vue3 中 diff 算法优化

## Vue2 中 diff 算法的痛点

Vue2 中 diff 算法是全量比较，当某个节点发生变化时，会遍历虚拟 DOM 中全部的节点查看是否发生了变化，再进行修改

## Vue3 的优化

1. 引入了 **静态标记** 和 **块级标记**，优化了 **双端比较** 的逻辑，可以跳过不需要比较的静态节点和块级节点，提高了性能
2. 引入了 **片段** 的概念，简化了 dom 结构，减少了比较次数
3. 优化了 **最长递增子序列** 的算法，可以更准确地找到需要移动的节点，减少了 dom 操作

## 解释

1. **静态标记（PatchFlag）**是在编译时给节点打上的一些标志，表示节点的类型、属性、子节点等是否有变化，例如 TEXT、CLASS、PROPS 等
2. **块级标记（ShapeFlag）**是在渲染时给节点打上的一些标志，表示节点的结构、内容、类型等是否有变化，例如 ELEMENT、TEXT、FRAGMENT 等
3. **片段（Fragment）**是 Vue3 中引入的一个新概念，它可以让组件返回多个根节点，而不需要包裹在一个父节点中。这样可以简化 dom 结构，减少比较次数
4. **最长递增子序列（Longest Increasing Subsequence，LIS）**是一个经典的动态规划问题，其目标是找到给定序列中最长的递增子序列，使得子序列中的元素按照顺序递增。例如，对于序列 [10, 9, 2, 5, 3, 7, 101, 18]，最长递增子序列是 [2, 3, 7, 101]，长度为 4
