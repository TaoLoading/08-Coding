# 回流、重绘、重排

## 回流（reflow）

1. 概念

   当 DOM 元素的尺寸、位置、内容发生改变时，会触发回流。回流是整个渲染过程中最消耗性能的一个阶段，会导致浏览器重新计算页面布局，并重新绘制所有受影响的元素

2. 导致原因

   1. 添加、删除、修改 DOM 元素
   2. 修改元素的位置、尺寸、内容
   3. 修改页面的默认样式、字体大小等
   4. 改变窗口大小、滚动页面等

## 重绘（repaint）

1. 概念

   当 DOM 元素的样式（除了位置、尺寸和布局之外）发生改变时，会触发重绘。重绘不会改变元素的位置和尺寸，只是重新绘制元素的外观，性能消耗较小

2. 导致原因

   1. 修改元素的背景色、字体颜色、边框颜色等
   2. 添加阴影、透明度等效果

## 重排（layout）

1. 概念

   当 DOM 元素的尺寸、位置、布局发生改变时，会触发重排。**重排包括了回流和重绘的过程**，因为它会导致浏览器重新计算布局，并重新绘制所有受影响的元素

2. 导致原因

   回流 + 重绘

**注：回流必将引起重绘，重绘不一定会引起回流**

## 避免回流和重排

1. 合并多次操作：通过合并多次对 DOM 的操作，可以减少回流和重排的次数。比如，可以使用文档碎片来批量添加 DOM 元素
2. 缓存 DOM 元素：多次使用的 DOM 元素可以缓存起来，避免重复查询 DOM 树，提高性能
3. 减少 DOM 元素的修改：尽可能使用 CSS3 动画等方式来实现视觉效果
4. 使用 CSS3 硬件加速：可以使用一些 CSS3 的属性，如`transform`、`opacity`等来实现动画效果，这些属性可以触发 GPU 硬件加速
5. 避免强制同步布局：当读取元素的布局信息（如宽度、高度等）时，浏览器需要强制同步布局，这会导致回流。可以使用`getBoundingClientRect()`等 API 来获取元素布局信息，这些 API 可以在不强制同步布局的情况下获取布局信息