# 事件循环（Event Loop）

## 定义

事件循环（Event Loop）是 JavaScript 中处理异步操作的机制。事件循环的核心作用是监控主线程和异步任务队列，采用循环的形式按一定顺序执行事件

## 执行顺序

1. 首先执行主线程上的同步任务

2. 遇到异步代码时，如果是宏任务（如 setTimeout/setInterval），则将其放入宏任务队列；如果是微任务（如 Promise.then/nextTick），则将其放入微任务队列

3. 当主线程上的同步代码执行完毕后，首先检查微任务队列，如果有未执行的微任务，则依次执行完所有的微任务

4. 然后再检查 DOM 渲染，如果有需要更新的 DOM，则进行渲染

5. 最后再从宏任务队列中取出一个宏任务并执行，然后重复上述过程

   ***注：*** 步骤 5 中重复上述过程意味着执行完该宏任务后，若有微任务加入则会先执行新加入的微任务，经过 1-4 步骤后再检索下一个宏任务

## 浏览器与 Node 中事件循环的区别

两者最主要的区别在于微任务的执行时机：

1. 浏览器中的 Event Loop 如上述所示
2. Node 中的  Event Loop 会分为多个阶段，每个阶段都包含各自的队列，其中微任务是在每个阶段之后执行
