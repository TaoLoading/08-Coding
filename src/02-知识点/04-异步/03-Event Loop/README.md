# 事件循环（Event Loop）

## 定义

事件循环（Event Loop）是一个在 JavaScript 中处理异步操作的机制。事件循环的核心作用是监控主线程和任务队列，如果主线程为空，事件循环会从任务队列中取出一个消息并处理它，这个过程是循环进行的，因此被称为”事件循环“

## 执行顺序

1. 首先执行主线程上的同步任务

2. 遇到异步代码时，如果是宏任务（如 setTimeout/setInterval），则将其放入宏任务队列；如果是微任务（如 Promise.then/nextTick），则将其放入微任务队列

3. 当主线程上的同步代码执行完毕后，首先检查微任务队列，如果有未执行的微任务，则依次执行完所有的微任务

4. 然后再检查 DOM 渲染，如果有需要更新的 DOM，则进行渲染

5. 最后再从宏任务队列中取出一个宏任务并执行，然后重复上述过程

   ***注：*** 步骤 5 中重复上述过程意味着执行完该宏任务后，若有微任务加入则会先执行新加入的微任务，经过 1-4 步骤后再检索下一个宏任务

## 浏览器与 Node 中事件循环的区别

两者最主要的区别在于微任务的执行时机：

1. 浏览器中的微任务是在每个宏任务后执行
2. Node 中的微任务是在每个阶段后执行
